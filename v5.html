<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEO-SYSTEM // V5_HYBRID</title>
    <style>
        :root { --neon: #00f2ff; --accent: #ff007b; --bg: #030303; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Orbitron', sans-serif; height: 100vh; display: flex; overflow: hidden; }

        /* --- MOBILE DRAWER --- */
        .sys-panel {
            width: 320px; background: rgba(10,10,10,0.95); border-right: 2px solid var(--neon);
            padding: 20px; display: flex; flex-direction: column; z-index: 200;
            transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        }
        @media (max-width: 900px) {
            .sys-panel { position: absolute; transform: translateX(-100%); width: 85%; height: 100%; }
            .sys-panel.active { transform: translateX(0); }
        }

        .main-stage { flex: 1; position: relative; display: flex; align-items: center; justify-content: center; overflow: hidden; }

        /* --- UI SCALING --- */
        .reactor {
            width: min(60vw, 250px); height: min(60vw, 250px);
            background: rgba(0,0,0,0.9); border: 2px solid var(--neon);
            clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 10; box-shadow: 0 0 40px var(--neon); transition: 0.1s;
        }

        .control-deck {
            position: absolute; bottom: 0; width: 100%; max-width: 700px;
            background: rgba(10,10,10,0.95); border: 1px solid var(--neon);
            padding: 20px; display: flex; flex-direction: column; gap: 10px;
            clip-path: polygon(5% 0, 95% 0, 100% 100%, 0% 100%);
        }

        /* HIDE RETICLE ON MOBILE */
        #reticle { display: block; position: fixed; width: 40px; height: 40px; border: 1px solid var(--neon); border-radius: 50%; pointer-events: none; z-index: 1000; transform: translate(-50%, -50%); }
        @media (max-width: 900px) { #reticle { display: none; } }

        .btn-v5 { background: none; border: 1px solid var(--neon); color: white; padding: 10px; cursor: pointer; }
        .mobile-toggle { position: fixed; top: 15px; left: 15px; z-index: 300; background: black; border: 1px solid var(--neon); color: var(--neon); padding: 10px; display: none; }
        @media (max-width: 900px) { .mobile-toggle { display: block; } }

        #viz-canvas { position: absolute; bottom: 0; width: 100%; height: 50%; opacity: 0.5; }
    </style>
</head>
<body>

    <div id="reticle"></div>
    <button class="mobile-toggle" onclick="document.querySelector('.sys-panel').classList.toggle('active')">FILES</button>

    <div class="sys-panel">
        <div style="color: var(--accent); font-size: 12px; margin-bottom: 20px;">/// SYSTEM_ARCHITECT_V5</div>
        <div onclick="document.getElementById('up').click()" style="border:1px dashed var(--neon); padding:20px; text-align:center; font-size:10px; cursor:pointer;">UPLOAD_DATA</div>
        <input type="file" id="up" hidden onchange="handleUp(event)">
        <div id="playlist-container" style="flex:1; overflow-y:auto; margin-top:20px;"></div>
    </div>

    <div class="main-stage">
        <canvas id="viz-canvas"></canvas>
        <div class="reactor" id="reactor-core">
            <div id="emoji-core" style="font-size: 3rem;">üí†</div>
            <div id="track-id" style="font-size: 9px; color: var(--neon);">IDLE</div>
        </div>

        <div class="control-deck">
            <div style="display:flex; justify-content: space-between; align-items:center;">
                <button class="btn-v5" onclick="prev()">‚èÆÔ∏è</button>
                <button class="btn-v5" onclick="toggle()">‚ñ∂Ô∏è / ‚è∏Ô∏è</button>
                <button class="btn-v5" onclick="next()">‚è≠Ô∏è</button>
            </div>
            <input type="range" id="scrubber" value="0" style="width:100%; accent-color: var(--neon);">
            <div style="display:flex; justify-content:space-between; font-size:10px;">
                <span id="title-display">AWAITING_DATA...</span>
                <select id="protocol" onchange="changeProtocol()" style="background:black; color:var(--neon); border:1px solid var(--neon); font-size:9px;">
                    <option value="1">STANDARD</option>
                    <option value="1.8">OVERDRIVE</option>
                </select>
            </div>
        </div>
    </div>

    <script>
        let db = [{title: "Strangers", file: "Kenya Grace - Strangers (Official Lyric Video)(MP3_160K).mp3"}];
        let index = 0, audio = new Audio(), isPlaying = false, aCtx, analyser, source;

        function handleUp(e) {
            const f = e.target.files[0];
            if(f) { db.push({title: f.name, file: URL.createObjectURL(f)}); render(); }
        }

        function render() {
            const c = document.getElementById('playlist-container');
            c.innerHTML = '';
            db.forEach((t, i) => {
                const n = document.createElement('div');
                n.style.padding = '10px'; n.style.fontSize = '11px';
                n.style.borderBottom = '1px solid #222';
                n.innerHTML = `> [${i}] ${t.title.substring(0,20)}`;
                n.onclick = () => { index = i; load(); };
                c.appendChild(n);
            });
        }

        function load() {
            audio.src = db[index].file;
            document.getElementById('title-display').innerText = db[index].title.toUpperCase();
            if(isPlaying) audio.play();
            render();
        }

        function toggle() {
            if(!aCtx) {
                aCtx = new AudioContext();
                analyser = aCtx.createAnalyser();
                source = aCtx.createMediaElementSource(audio);
                source.connect(analyser); analyser.connect(aCtx.destination);
                analyser.fftSize = 64;
                loop();
            }
            isPlaying ? audio.pause() : audio.play();
            isPlaying = !isPlaying;
        }

        function loop() {
            const canvas = document.getElementById('viz-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth; canvas.height = window.innerHeight/2;
            const data = new Uint8Array(analyser.frequencyBinCount);
            function frame() {
                requestAnimationFrame(frame);
                analyser.getByteFrequencyData(data);
                ctx.clearRect(0,0,canvas.width, canvas.height);
                data.forEach((v, i) => {
                    ctx.fillStyle = `rgba(0, 242, 255, ${v/255})`;
                    ctx.fillRect(i * (canvas.width/32), canvas.height - v, (canvas.width/32)-2, v);
                });
                document.getElementById('reactor-core').style.transform = `scale(${1 + data[2]/400})`;
            }
            frame();
        }

        document.addEventListener('mousemove', (e) => {
            const r = document.getElementById('reticle');
            if(r) { r.style.left = e.clientX + 'px'; r.style.top = e.clientY + 'px'; }
        });

        audio.ontimeupdate = () => { document.getElementById('scrubber').value = (audio.currentTime/audio.duration)*100 || 0; };
        document.getElementById('scrubber').oninput = (e) => { audio.currentTime = (e.target.value/100) * audio.duration; };

        function next() { index = (index + 1) % db.length; load(); }
        function prev() { index = (index - 1 + db.length) % db.length; load(); }
        load();
    </script>
</body>
</html>
