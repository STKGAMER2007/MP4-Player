<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEO-SYSTEM // OVERDRIVE</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=JetBrains+Mono:wght@300&display=swap');

        :root {
            --neon: #00f2ff;
            --danger: #ff003c;
            --bg: #050505;
            --ui-blue: rgba(0, 242, 255, 0.1);
        }

        body {
            margin: 0; background: var(--bg); color: white;
            font-family: 'Orbitron', sans-serif; height: 100vh;
            display: flex; justify-content: center; align-items: center; overflow: hidden;
        }

        /* --- THE REACTOR FRAME --- */
        .reactor-container {
            position: relative; width: 400px; height: 400px;
            display: flex; justify-content: center; align-items: center;
        }

        #reactor-canvas {
            position: absolute; width: 100%; height: 100%;
            transition: filter 0.3s;
        }

        .hexagon-core {
            width: 180px; height: 180px;
            background: rgba(255,255,255,0.05);
            clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border: 2px solid var(--neon); z-index: 10;
            text-align: center; padding: 20px;
        }

        /* --- HUD ELEMENTS --- */
        .hud-overlay {
            position: absolute; width: 950px; height: 600px;
            border: 1px solid var(--ui-blue); pointer-events: none;
            display: flex; flex-direction: column; justify-content: space-between; padding: 20px;
        }

        .data-stream { font-family: 'JetBrains Mono'; font-size: 10px; color: var(--neon); opacity: 0.6; }

        /* --- OVERDRIVE & GLITCH --- */
        @keyframes overdrive-shake {
            0% { transform: translate(0); }
            25% { transform: translate(2px, -2px); }
            50% { transform: translate(-2px, 2px); }
            75% { transform: translate(2px, 2px); }
            100% { transform: translate(0); }
        }

        .overdrive-active {
            --neon: var(--danger) !important;
            animation: overdrive-shake 0.1s infinite;
            filter: saturate(2) contrast(1.2);
        }

        .glitch-text { animation: glitch 0.3s steps(2); }
        @keyframes glitch {
            0% { clip-path: inset(50% 0 30% 0); transform: translateX(-5px); }
            50% { clip-path: inset(10% 0 80% 0); transform: translateX(5px); }
            100% { clip-path: inset(0); transform: translateX(0); }
        }

        /* --- PLAYER BAR --- */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; height: 100px;
            background: rgba(0,0,0,0.9); border-top: 1px solid var(--ui-blue);
            display: flex; align-items: center; justify-content: space-around; padding: 0 50px;
        }

        .vol-slider { accent-color: var(--neon); width: 120px; }
        .btn { background: none; border: 1px solid var(--neon); color: var(--neon); 
               padding: 10px; cursor: pointer; border-radius: 4px; transition: 0.2s; }
        .btn:hover { background: var(--neon); color: black; box-shadow: 0 0 15px var(--neon); }

        #song-id { font-size: 0.7rem; color: var(--neon); margin-bottom: 5px; }
    </style>
</head>
<body>

    <div class="hud-overlay" id="hud">
        <div style="display: flex; justify-content: space-between;">
            <div class="data-stream">STATUS: CONNECTED<br>BITRATE: 160KBPS<br>MODE: ANALYZE</div>
            <div class="data-stream" id="clock">00:00:00</div>
        </div>
        <div class="data-stream">SYSTEM_LOG: <span id="log-msg">READY_</span></div>
    </div>

    <div class="reactor-container" id="main-frame">
        <canvas id="reactor-canvas"></canvas>
        <div class="hexagon-core" id="core">
            <div id="song-id">ID_00</div>
            <div id="title" style="font-size: 0.9rem; font-weight: bold; margin: 5px 0;">SELECT TRACK</div>
            <div id="artist" style="font-size: 0.6rem; opacity: 0.7;">NO DATA</div>
        </div>
    </div>

    <div class="bottom-nav">
        <div style="width: 200px; font-size: 10px;">
            <div id="cur-track-name">---</div>
            <div style="height: 2px; background: #222; margin-top: 5px; width: 100%;">
                <div id="progress" style="height: 100%; background: var(--neon); width: 0%;"></div>
            </div>
        </div>

        <div style="display: flex; gap: 15px;">
            <button class="btn" onclick="prev()"><i data-lucide="skip-back"></i></button>
            <button class="btn" id="play-btn" onclick="toggle()"><i data-lucide="play"></i></button>
            <button class="btn" onclick="next()"><i data-lucide="skip-forward"></i></button>
        </div>

        <div style="display: flex; align-items: center; gap: 10px;">
            <i data-lucide="volume-2" size="16"></i>
            <input type="range" id="volume" class="vol-slider" min="0" max="1" step="0.01" value="0.7">
            <span id="vol-warn" style="font-size: 8px; color: var(--danger); display: none;">CRITICAL</span>
        </div>
    </div>

    <script>
        const playlist = [
            { title: "Strangers", artist: "Kenya Grace", file: "Kenya Grace - Strangers (Official Lyric Video)(MP3_160K).mp3", id: "KG-01" },
            { title: "Sweater Weather", artist: "The Neighbourhood", file: "Sweater Weather(MP3_160K).mp3", id: "TN-02" },
            { title: "A COLD PLAY", artist: "The Kid LAROI", file: "The Kid LAROI - A COLD PLAY (Official Audio)(MP3_160K).mp3", id: "KL-03" },
            { title: "Dark Place", artist: "O4ue", file: "Lost in a Dark Place(MP3_160K)_1.mp3", id: "OE-04" },
            { title: "Adore You", artist: "Bryant Barnes", file: "Adore You(MP3_160K).mp3", id: "BB-05" }
        ];

        // Raw base to serve audio files from this repo/commit. If you host differently, change this.
        const rawBase = 'https://raw.githubusercontent.com/STKGAMER2007/MP4-Player/ccb13375bff62b9538a53702d332cf14a525a180/';

        let index = 0;
        let isPlaying = false;
        let audio = new Audio();
        audio.preload = 'auto';
        audio.crossOrigin = 'anonymous';
        let aCtx, analyser, source;

        // error / status handlers to help debugging
        audio.addEventListener('error', (e) => {
            console.error('Audio failed to load/play:', audio.src, e);
            document.getElementById('log-msg').innerText = 'LOAD_ERROR';
        });
        audio.addEventListener('canplay', () => {
            document.getElementById('log-msg').innerText = 'READY';
        });
        audio.addEventListener('loadedmetadata', () => {
            if (!isNaN(audio.duration)) {
                document.getElementById('log-msg').innerText = `DURATION_${audio.duration.toFixed(1)}s`;
            }
        });

        function typeWriter(text) {
            let i = 0;
            const el = document.getElementById('title');
            el.innerHTML = '';
            el.classList.add('glitch-text');
            const timer = setInterval(() => {
                if (i < text.length) { el.append(text.charAt(i)); i++; } 
                else { clearInterval(timer); el.classList.remove('glitch-text'); }
            }, 50);
        }

        function load(idx) {
            index = idx;
            const s = playlist[index];

            // pause and clear previous source while switching
            audio.pause();

            // Use raw.githubusercontent URL so it can be fetched from the repo.
            // Make sure that file names match exactly and are present in the repository root.
            audio.src = rawBase + encodeURIComponent(s.file);
            audio.load();

            document.getElementById('song-id').innerText = s.id;
            document.getElementById('artist').innerText = s.artist.toUpperCase();
            document.getElementById('cur-track-name').innerText = s.title;
            typeWriter(s.title.toUpperCase());
            document.getElementById('log-msg').innerText = `LOADING_FILE_${s.id}...`;

            // if the player was already playing, attempt to resume playback
            if (isPlaying) {
                // play() returns a promise; catch rejections (autoplay prevention)
                audio.play().catch(err => {
                    console.error('play() rejected', err);
                    document.getElementById('log-msg').innerText = 'PLAY_BLOCKED';
                });
            }
        }

        function toggle() {
            // create/resume AudioContext on user gesture
            if(!aCtx) initAudio();
            if (aCtx && aCtx.state === 'suspended') {
                aCtx.resume().catch(e => console.warn('aCtx.resume() failed', e));
            }

            if(isPlaying) {
                audio.pause();
                isPlaying = false;
            } else {
                audio.play().then(() => {
                    isPlaying = true;
                }).catch(err => {
                    console.error('play() rejected', err);
                    document.getElementById('log-msg').innerText = 'PLAY_BLOCKED';
                    isPlaying = false;
                });
            }

            document.getElementById('play-btn').innerHTML = isPlaying ? '<i data-lucide="pause"></i>' : '<i data-lucide="play"></i>';
            lucide.createIcons();
        }

        function initAudio() {
            aCtx = new AudioContext();
            analyser = aCtx.createAnalyser();
            source = aCtx.createMediaElementSource(audio);
            source.connect(analyser); analyser.connect(aCtx.destination);
            analyser.fftSize = 256;
            drawReactor();
        }

        function drawReactor() {
            const canvas = document.getElementById('reactor-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 400; canvas.height = 400;
            const data = new Uint8Array(analyser.frequencyBinCount);

            function animate() {
                requestAnimationFrame(animate);
                analyser.getByteFrequencyData(data);
                ctx.clearRect(0,0,400,400);
                
                const centerX = 200, centerY = 200, radius = 110;
                
                for(let i=0; i < data.length; i++) {
                    const barHeight = data[i] * 0.4;
                    const angle = (i / data.length) * Math.PI * 2;
                    const x1 = centerX + Math.cos(angle) * radius;
                    const y1 = centerY + Math.sin(angle) * radius;
                    const x2 = centerX + Math.cos(angle) * (radius + barHeight);
                    const y2 = centerY + Math.sin(angle) * (radius + barHeight);

                    ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--neon') || '#00f2ff';
                    ctx.lineWidth = 2;
                    ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
                }
            }
            animate();
        }

        // --- OVERDRIVE LOGIC ---
        document.getElementById('volume').oninput = (e) => {
            const val = parseFloat(e.target.value);
            audio.volume = val;
            const frame = document.getElementById('main-frame');
            if(val >= 0.95) {
                document.body.classList.add('overdrive-active');
                document.getElementById('vol-warn').style.display = 'block';
            } else {
                document.body.classList.remove('overdrive-active');
                document.getElementById('vol-warn').style.display = 'none';
            }
        };

        audio.ontimeupdate = () => {
            if (audio.duration && !isNaN(audio.duration) && audio.duration > 0) {
                document.getElementById('progress').style.width = (audio.currentTime/audio.duration)*100 + "%";
            } else {
                document.getElementById('progress').style.width = '0%';
            }
        };

        function next() { load((index + 1) % playlist.length); }
        function prev() { load((index - 1 + playlist.length) % playlist.length); }

        setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
        
        load(0);
        lucide.createIcons();
    </script>
</body>
</html>
